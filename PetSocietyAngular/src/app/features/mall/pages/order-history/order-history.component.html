<div class="mall-container fadein animation-duration-500 py-5" style="max-width: 1600px; margin: 0 auto;">

  <div class="flex flex-column md:flex-row align-items-center justify-content-between gap-3 mb-5 pb-3 mx-3"
    style="border-bottom: 2px solid var(--color-primary-light); min-height: 4.5rem;">

    <div class="flex align-items-center gap-3">
      <i class="pi pi-list text-4xl" style="color: var(--color-btn);"></i>
      <h1 class="text-3xl font-bold m-0" style="color: var(--color-text-dark);">æˆ‘çš„è¨‚å–®ç´€éŒ„</h1>
    </div>

    <button pButton label="ç¹¼çºŒè³¼ç‰©" icon="pi pi-arrow-left"
      class="p-button-sm p-button-outlined p-button-secondary border-round-2xl fadein animation-duration-500"
      routerLink="/mall">
    </button>
  </div>

  <div *ngIf="isLoading"
    class="flex flex-column justify-content-center align-items-center w-full fadein animation-duration-500"
    style="min-height: 400px;">
    <i class="pi pi-heart-fill loading-heart-icon mb-3"></i>
    <div class="text-primary-600 font-bold text-xl">æ­£åœ¨å°‹æ‰¾æ‚¨çš„å›æ†¶... ğŸ§¾âœ¨</div>
  </div>

  <div *ngIf="!isLoading" class="fadein animation-duration-500">

    <div *ngIf="orders.length > 0; else emptyState">

      <div class="surface-card p-4 border-round-2xl shadow-1 mx-3">

        <div class="flex flex-column gap-4">
          <p-accordion styleClass="order-accordion">

            <p-accordion-panel *ngFor="let order of orders" [value]="order.orderId"
              styleClass="mb-3 border-1 surface-border border-round-xl overflow-hidden hover:shadow-2 transition-all transition-duration-300 bg-white">

              <p-accordion-header>
                <div class="flex flex-wrap align-items-center justify-content-between w-full gap-3 py-1 pr-3">

                  <div class="flex flex-column gap-1">
                    <div class="flex align-items-center gap-2">
                      <span class="text-500">è¨‚å–®ç·¨è™Ÿ</span>
                      <span class="font-bold text-900 text-lg font-monospace select-all">{{ order.orderNumber }}</span>
                    </div>
                    <div class="text-500 text-sm flex align-items-center gap-2">
                      <span><i class="pi pi-calendar mr-1"></i>{{ order.orderDate | date:'yyyy/MM/dd HH:mm' }}</span>
                      <span *ngIf="order.paymentDate"
                        class="text-green-600 bg-green-50 px-2 border-round-lg text-xs font-bold">
                        å·²ä»˜æ¬¾
                      </span>
                    </div>
                  </div>

                  <div class="flex align-items-center gap-3 md:gap-4 ml-auto sm:ml-0">

                    <div class="text-right">
                      <div class="text-xs text-500 mb-1">è¨‚å–®é‡‘é¡</div>
                      <span class="text-xl font-bold text-primary">NT$ {{ order.totalAmount | number }}</span>
                    </div>

                    <p-tag [value]="getStatusName(order.status)" [severity]="getStatusSeverity(order.status)"
                      styleClass="px-3 py-1 text-sm border-round-xl"></p-tag>

                    <div *ngIf="order.status === 'Pending'" class="flex align-items-center gap-2">
                      <button pButton type="button" label="å–æ¶ˆ"
                        class="p-button-sm p-button-outlined p-button-secondary border-round-2xl"
                        (click)="onCancelOrder(order.orderId); $event.stopPropagation()">
                      </button>
                      <button pButton type="button" label="ä»˜æ¬¾" icon="pi pi-credit-card"
                        class="p-button-sm p-button-danger border-round-2xl shadow-2"
                        (click)="payNow(order.orderId); $event.stopPropagation()">
                      </button>
                    </div>

                    <div *ngIf="order.status === 'Cancelled' || order.status === 'Completed'"
                      class="flex align-items-center">
                      <button pButton type="button" icon="pi pi-trash" pTooltip="åˆªé™¤æ­¤ç´€éŒ„" tooltipPosition="top"
                        class="p-button-rounded p-button-text p-button-secondary text-400 hover:text-red-500 hover:bg-red-50 transition-colors transition-duration-200"
                        (click)="onDeleteOrder(order.orderId); $event.stopPropagation()">
                      </button>
                    </div>

                  </div>
                </div>
              </p-accordion-header>

              <p-accordion-content>
                <div class="p-1">

                  <div
                    class="surface-100 p-4 border-round-xl mb-4 flex flex-column md:flex-row gap-4 align-items-start">
                    <div class="flex align-items-center gap-2 text-700 font-bold min-w-max">
                      <i class="pi pi-truck text-xl"></i>
                      <span>é…é€è³‡è¨Š</span>
                    </div>
                    <div class="grid w-full m-0">
                      <div class="col-12 md:col-4 p-1">
                        <span class="text-500 text-sm block mb-1">æ”¶ä»¶äºº</span>
                        <span class="text-900 font-medium">{{ order.receiverName }}</span>
                      </div>
                      <div class="col-12 md:col-4 p-1">
                        <span class="text-500 text-sm block mb-1">è¯çµ¡é›»è©±</span>
                        <span class="text-900 font-medium">{{ order.receiverPhone }}</span>
                      </div>
                      <div class="col-12 md:col-12 p-1">
                        <span class="text-500 text-sm block mb-1">é…é€åœ°å€</span>
                        <span class="text-900 font-medium">{{ order.receiverAddress }}</span>
                      </div>
                    </div>
                  </div>

                  <h4 class="m-0 mb-3 text-700 pl-2 border-left-3 border-primary">å•†å“æ˜ç´°</h4>

                  <div class="flex flex-column gap-3">
                    <div *ngFor="let item of order.details"
                      class="flex align-items-center p-3 border-1 surface-border border-round-xl bg-white hover:surface-50 transition-colors transition-duration-200">

                      <div class="relative">
                        <img
                          [src]="item.thumbnail ? item.thumbnail : 'https://placehold.co/100x100/F2EBE5/5E5344?text=No+Image'"
                          class="w-5rem h-5rem border-round-lg shadow-1" style="object-fit: cover;" alt="å•†å“åœ–ç‰‡">
                        <span
                          class="absolute border-circle bg-primary text-white font-bold flex align-items-center justify-content-center text-xs"
                          style="width:24px; height:24px; top:-8px; right:-8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2)">
                          {{ item.quantity }}
                        </span>
                      </div>

                      <div class="flex-1 ml-3">
                        <div class="font-bold text-900 text-lg mb-1">{{ item.productName }}</div>
                        <div class="text-500 text-sm">å–®åƒ¹: ${{ item.price | number }}</div>
                      </div>

                      <div class="text-right ml-3">
                        <div class="text-sm text-500 mb-1">å°è¨ˆ</div>
                        <div class="text-primary font-bold text-xl">NT$ {{ item.price * item.quantity | number }}</div>
                      </div>
                    </div>
                  </div>

                </div>
              </p-accordion-content>

            </p-accordion-panel>
          </p-accordion>
        </div>

      </div>
    </div>

    <ng-template #emptyState>
      <div
        class="flex flex-column align-items-center justify-content-center p-5 text-center fadein animation-duration-500 mt-5">

        <div class="border-circle surface-100 p-5 mb-4">
          <img src="images/naiyue-empty-box.png" alt="No Orders" class="w-15rem"
            style="object-fit: contain; filter: grayscale(0.2);">
        </div>

        <h2 class="text-900 font-bold mb-2">é€™è£¡ç©ºç©ºçš„...</h2>
        <p class="text-600 text-lg mb-5 line-height-3" style="max-width: 400px;">
          ç®±å­è£¡å†·é¢¼é¢¼çš„...<br>
          æŠŠæ‹”é¦¬éº»è¦ä¸è¦è²·é»ç¦®ç‰©å¡«æ»¿å®ƒå‘¢ï¼ŸğŸ¥º
        </p>

        <button pButton label="å‰å¾€å•†åŸé€›é€›" icon="pi pi-shopping-bag"
          class="p-button-rounded p-button-lg shadow-4 bg-primary border-primary hover:bg-primary-reverse"
          routerLink="/mall">
        </button>
      </div>
    </ng-template>

  </div>
</div>